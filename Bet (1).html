<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Department Fund Manager (Online)</title>

<!-- SUPABASE CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>

<script>
/* ðŸ”´ REPLACE THESE TWO */
const SUPABASE_URL = 'https://hdhpiutigravrfxdxcxq.supabase.co'
const SUPABASE_ANON_KEY = 'PASTE_YOUR_ANON_PUBLIC_KEY_HERE'

const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
</script>

<style>
body{
  margin:0; min-height:100vh; font-family:Arial;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
}
.card{
  background:#fff; border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.35);
}
#loginPage{width:360px;margin:120px auto;padding:25px;text-align:center}
#dashboard{display:none;padding:40px;display:flex;flex-direction:column;align-items:center}
input{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid #aaa}
button{padding:10px;border:none;border-radius:8px;font-weight:bold;color:white;cursor:pointer}
.btn-blue{background:#007bff}
.btn-green{background:#28a745}
.btn-red{background:#dc3545}
.box{width:520px;padding:22px;margin-bottom:25px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #bbb;padding:8px;text-align:center}
.pending{color:orange;font-weight:bold}
.approved{color:green;font-weight:bold}
.cancelled{color:red;font-weight:bold}
h2,h3{text-align:center}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage" class="card">
<h2>Login</h2>
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<button class="btn-blue" onclick="login()">Login</button>
<p id="msg" style="color:red;font-weight:bold"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
<h2 style="color:white">Department Fund Dashboard</h2>
<p style="color:white">
User: <b><span id="uName"></span></b> |
Dept: <b><span id="uDept"></span></b> |
Role: <b><span id="uRole"></span></b>
</p>
<button class="btn-red" onclick="logout()">Logout</button>

<!-- REQUEST -->
<div class="card box">
<h3>Usage Request</h3>
<input id="item" placeholder="Item">
<input id="amount" type="number" placeholder="Amount">
<button class="btn-blue" onclick="sendRequest()">Send Request</button>
<p id="info"></p>
</div>

<!-- HISTORY -->
<div class="card box">
<h3>History</h3>
<table id="historyTable"></table>
</div>
</div>

<script>
/* USERS (STATIC LOGIN) */
const users = {
  mani:{pwd:"mani",role:"admin",dept:"IT"},
  manoj:{pwd:"manoj",role:"admin",dept:"Sales"},
  gothavari:{pwd:"gothavari",role:"admin",dept:"HR"},
  naga:{pwd:"naga",role:"emp",dept:"IT"},
  sakthi:{pwd:"sakthi",role:"emp",dept:"Sales"},
  preethi:{pwd:"preethi",role:"emp",dept:"Sales"},
  navya:{pwd:"navya",role:"emp",dept:"Accounts"}
}

let currentUser = {}

/* LOGIN */
function login(){
  const u = username.value.trim().toLowerCase()
  const p = password.value.trim()
  if(users[u] && users[u].pwd === p){
    currentUser = {name:u, ...users[u]}
    loginPage.style.display="none"
    dashboard.style.display="flex"
    uName.innerText = currentUser.name
    uDept.innerText = currentUser.dept
    uRole.innerText = currentUser.role
    loadHistory()
    listenRealtime()
  } else {
    msg.innerText = "Invalid Login"
  }
}

/* SEND REQUEST */
async function sendRequest(){
  if(!item.value || amount.value <= 0) return

  const { error } = await supabase
    .from('requests')
    .insert([{
      user: currentUser.name,
      dept: currentUser.dept,
      item: item.value,
      amount: Number(amount.value),
      status: 'pending'
    }])

  if(error){
    console.error(error)
    info.innerText = "Error sending request"
  } else {
    info.innerText = "Request sent"
    item.value=""
    amount.value=""
  }
}

/* LOAD HISTORY */
async function loadHistory(){
  const { data, error } = await supabase
    .from('requests')
    .select('*')
    .order('created_at', { ascending:false })

  if(error){
    console.error(error)
    return
  }

  historyTable.innerHTML =
    "<tr><th>User</th><th>Dept</th><th>Item</th><th>Amount</th><th>Status</th></tr>"

  data.forEach(r=>{
    if(currentUser.role==='admin' || r.user===currentUser.name){
      historyTable.innerHTML += `
        <tr>
          <td>${r.user}</td>
          <td>${r.dept}</td>
          <td>${r.item}</td>
          <td>${r.amount}</td>
          <td class="${r.status}">${r.status}</td>
        </tr>`
    }
  })
}

/* REALTIME LISTENER */
function listenRealtime(){
  supabase
    .channel('requests-realtime')
    .on(
      'postgres_changes',
      { event:'*', schema:'public', table:'requests' },
      () => loadHistory()
    )
    .subscribe()
}

function logout(){
  location.reload()
}
</script>

</body>
</html>












